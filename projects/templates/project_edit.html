{% extends "base.html" %}
{% load staticfiles %}
{% load widget_tweaks %}
{% block title %}HackLaunch - Edit Project{% endblock %}

{% block extra_css %}
    <link href="{% static "css/bootstrap-tagsinput.css" %}" media="all" rel="stylesheet" type="text/css"/>
    <link href="{% static "css/toastr.min.css" %}" media="all" rel="stylesheet" type="text/css"/>
    <link href="{% static "froala_editor/css/font-awesome.min.css" %}" media="all" rel="stylesheet" type="text/css"/>
    <link href="{% static "froala_editor/css/froala_editor.min.css" %}" media="all" rel="stylesheet" type="text/css"/>
    <link href="{% static "froala_editor/css/froala_style.min.css" %}" media="all" rel="stylesheet" type="text/css"/>
    <link href="//code.jquery.com/ui/1.11.4/themes/smoothness/jquery-ui.css" rel="stylesheet">
    <script src="{% static "js/jquery.min.js" %}"></script>
{% endblock %}

{% block content %}
    <div class="container">

        <form id="crators-form" action="." method="post">
            {% csrf_token %}
            <div class="row">
                <div class="col-md-12" style="padding-top: 25px;">
                    <div class="title animated fadeInDown animation-delay-5" style="padding: 10px; margin: 0px;">
                        <div id="logo-image">
                            {% if project.logo %}
                                <img id='logo' class='logo' src="{{ project.logo.url }}" alt="Logo" width="200" style="padding-bottom: 15px;"/>
                            {% else %}
                                <img id='logo' class='logo' src="{% static "images/add-a-logo.png" %}" alt="Logo" width="200" style="padding-bottom: 15px;"/>
                            {% endif %}
                        </div>
                        <div id="project-title" class="project-title">
                            {% autoescape off %} {{ project.title }} {% endautoescape %}
                        </div>
                    </div>
                    <div id="project-tagline" class="slogan text-center no-margin-bottom project-tagline">
                        {% autoescape off %} {{ project.tag_line }} {% endautoescape %}
                    </div>
                </div>

                <div class="col-md-12 center">
                    <div class="small-margin-bottom fadeInDown animation-delay-3"
                         style="margin-top: 20px;">
                        {% if project.facebook %}
                            <a id='link-facebook' href="#" class="social-icon-ar facebook" data-link="{{ project.facebook }}"
                               onclick="editSocialURL('facebook', $(this).data('link'))" >
                                <i class="fa fa-facebook"></i></a>
                        {% else %}
                            <a id='link-facebook' href="#" class="social-icon-ar grey"
                               onclick="editSocialURL('facebook', 'http://www.facebook.com/')"><i
                                    class="fa fa-facebook"></i></a>
                        {% endif %}

                        {% if project.google_plus %}
                            <a id='link-google-plus' href="#" class="social-icon-ar google-plus" data-link="{{ project.google_plus.url }}"
                               onclick="editSocialURL('google-plus', $(this).data('link'))">
                                    <i class="fa fa-google-plus"></i></a>
                        {% else %}
                            <a id='link-google-plus' href="#" class="social-icon-ar grey"
                               onclick="editSocialURL('google-plus', 'http://plus.google.com/')"><i
                                    class="fa fa-google-plus"></i></a>
                        {% endif %}

                        {% if project.instagram %}
                            <a id='link-instagram' href="#" class="social-icon-ar instagram" data-link="{{ project.instagram.url }}"
                               onclick="editSocialURL('instagram', $(this).data('link'))">
                                    <i class="fa fa-instagram"></i></a>
                        {% else %}
                            <a id='link-instagram' href="#" class="social-icon-ar grey"
                               onclick="editSocialURL('instagram', 'http://www.instagram.com/')"><i
                                    class="fa fa-instagram"></i></a>
                        {% endif %}

                        {% if project.pinterest %}
                            <a id='link-pinterest' href="#" class="social-icon-ar pinterest" data-link="{{ project.pinterest.url }}"
                               onclick="editSocialURL('pinterest', $(this).data('link'))">
                                    <i class="fa fa-pinterest"></i></a>
                        {% else %}
                            <a id='link-pinterest' href="#" class="social-icon-ar grey"
                               onclick="editSocialURL('pinterest', 'http://www.pinterest.com/')"><i
                                    class="fa fa-pinterest"></i></a>
                        {% endif %}

                        {% if project.twitter %}
                            <a id='link-twitter' href="#" class="social-icon-ar twitter" data-link="{{ project.twitter.url }}"
                               onclick="editSocialURL('twitter', $(this).data('link'))">
                                    <i class="fa fa-twitter"></i></a>
                        {% else %}
                            <a id='link-twitter' href="#" class="social-icon-ar grey"
                               onclick="editSocialURL('twitter', 'http://www.twitter.com/')"><i
                                    class="fa fa-twitter"></i></a>
                        {% endif %}
                    </div>

                    <div id='div-facebook' class="row hidden" style="width:100%">
                        <div class="input-group" style="margin: 0 auto;">
                            <input id="id_facebook" class="form-control" type="text" style="width: 250px; margin-bottom: 5px" value="{% autoescape off %}{{ project.facebook }}{% endautoescape %}">

                            <button id="update-facebook" type="button" class="btn btn-ar btn-default"
                                    style="height: 35px; margin-left: 5px;" onclick="updateSocialURL('facebook')">
                                Update
                            </button>
                        </div>
                    </div>
                    <div id="div-instagram" class="row hidden" style="width:100%">
                        <div class="input-group" style="margin: 0 auto;">
                            <input id="id_instagram" class="form-control" type="text" style="width: 250px; margin-bottom: 5px" value="{% autoescape off %}{{ project.instagram }}{% endautoescape %}">
                            <button id="update-instagram" type="button" class="btn btn-ar btn-default"
                                    style="height: 35px; margin-left: 5px;" onclick="updateSocialURL('instagram')">
                                Update
                            </button>
                        </div>
                    </div>
                    <div id="div-google-plus" class="row hidden" style="width:100%">
                        <div class="input-group" style="margin: 0 auto;">
                            <input id="id_google-plus" class="form-control" type="text" style="width: 250px; margin-bottom: 5px" value="{% autoescape off %}{{ project.google_plus }}{% endautoescape %}">
                            <button id="update-google-plus" type="button" class="btn btn-ar btn-default"
                                    style="height: 35px; margin-left: 5px;" onclick="updateSocialURL('google-plus')">
                                Update
                            </button>
                        </div>
                    </div>
                    <div id="div-pinterest" class="row hidden" style="width:100%">
                        <div class="input-group" style="margin: 0 auto;">
                            <input id="id_pinterest" class="form-control" type="text" style="width: 250px; margin-bottom: 5px" value="{% autoescape off %}{{ project.pinterest }}{% endautoescape %}">
                            <button id="update-pinterest" type="button" class="btn btn-ar btn-default"
                                    style="height: 35px; margin-left: 5px;" onclick="updateSocialURL('pinterest')">
                                Update
                            </button>
                        </div>
                    </div>
                    <div id="div-twitter" class="row hidden" style="width:100%">
                        <div class="input-group" style="margin: 0 auto;">
                            <input id="id_twitter" class="form-control" type="text" style="width: 250px; margin-bottom: 5px" value="{% autoescape off %}{{ project.twitter }}{% endautoescape %}">
                            <button id="update-twitter" type="button" class="btn btn-ar btn-default"
                                    style="height: 35px; margin-left: 5px;" onclick="updateSocialURL('twitter')">
                                Update
                            </button>
                        </div>
                    </div>
                    <div id="social-link-error" class="hidden center">
                        <p class="hidden red" id="social-link-error-facebook">Please enter a valid Facebook link</p>
                        <p class="hidden red" id="social-link-error-google-plus">Please enter a valid Google Plus link</p>
                        <p class="hidden red" id="social-link-error-instagram">Please enter a valid Instagram link</p>
                        <p class="hidden red" id="social-link-error-pinterest">Please enter a valid Pinterest link</p>
                        <p class="hidden red" id="social-link-error-twitter">Please enter a valid Twitter link</p>
                    </div>
                    <div id="social-link-error-main" class="hidden">
                        <p style="text-align: center; color: red;">
                            <i class="fa fa-exclamation-circle" style="color: red;"></i>
                            <span id="social-link-error-main-message"></span>
                        </p>
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-md-9 ">
                    <h2 class="section-title no-margin-top no-margin-bottom">
                        Project Pitch
                    </h2>

                    <div id="{{ post_form.id }}" class="pitch-edit" style="margin-top: 10px; ">
                        {% autoescape off %} {{ project.pitch }} {% endautoescape %}
                    </div>

                    <div>
                        <h2 class="section-title">Time Line
                            <span><p class="btn btn-ar btn-primary pull-right" onclick="addPost()">Create New Post</p></span>
                        </h2>
                    </div>

                    <div id="add-post-errors" class="hidden">
                        <p style="text-align: center; color: red;">
                            <i class="fa fa-exclamation-circle" style="color: red;"></i>
                            <span id="add-post-errors-message"></span>
                        </p>
                    </div>

                    <ul id="time-line" class="timeline-2">
                        {% for post_form in project_posts %}
                            <br/>
                            <li class="animated fadeInRight animation-delay-2">
                                <time class="timeline-time" datetime="">{{ post_form.date_added }}</time>
                                <i class="timeline-2-point"></i>

                                <div class="panel panel-default">
                                    <div class="panel-heading" style="padding-bottom: 0px;">
                                        <div id="{{ post_form.id }}" class="post-title-edit" style="color: black; padding-bottom: 0px;">
                                            {% autoescape off %} {{ post_form.title }} {% endautoescape %}
                                        </div>
                                    </div>

                                    <div id="{{ post_form.id }}" class="post-edit">
                                         {% autoescape off %} {{ post_form.post }} {% endautoescape %}
                                    </div>

                                    <div style="padding: 5px;">
                                        <div style="display: inline-block">
                                            <label>Author </label>
                                            <select class='user-selection' selected="{{ post_form.creator.get_full_name }}" onchange="updatePost('{{ post_form.id }}', 'author', $(this.selectedOptions[0]).val())">
                                                {% for creator in project_creators %}
                                                    <option value="{{ creator.creator.username }}">{{ creator.creator.get_full_name }}</option>
                                                {% endfor %}
                                            </select>
                                        </div>

                                        <div class="pull-right">
                                            {% if post_form.is_published %}
                                                <input type="checkbox" name="{{ post_form.id }}-is-adimn" checked onchange="updatePost('{{ post_form.id }}', 'published', this.checked)">Publish post<br>
                                            {% else %}
                                                <input type="checkbox" name="{{ post_form.id }}-is-adimn" onchange="updatePost('{{ post_form.id }}', 'published', this.checked)">Publish post<br>
                                            {% endif %}
                                        </div>

                                        <div id="update-post-errors" class="hidden">
                                            <p style="text-align: center; color: red;">
                                                <i class="fa fa-exclamation-circle" style="color: red;"></i>
                                                <span id="update-post-errors-message"></span>
                                            </p>
                                        </div>
                                    </div>
                                </div>
                            </li>
                        {% endfor %}
                    </ul>
                </div>
                <div class="col-md-3">
                    <div class="content-box box-primary animated fadeInDown animation-delay-14">
                        <h4 class="content-box-title" style="margin-top: 0px; padding: 0px;"><strong>Contributors</strong></h4>

                        <div id="creators" class="media">
                            {% for creator in project_creators %}
                                {% if creator.is_active %}
                                    <div id="creator-{{ creator.creator.username }}">
                                        <div class="row">
                                            <div class="col-md-3">
                                                <a href="/users/{{ creator.creator.userprofile.slug }}">
                                                    <img src="{{ creator.creator.userprofile.get_thumbnail }}"
                                                         alt="{{ creator.creator.get_full_name }}" class="img-circle" style="width: 50px; height: 50px;">
                                                </a>
                                            </div>
                                            <div class="col-md-9" style="text-align: left;">
                                                <h4 id="{{ creator.creator.username }}" class="media-heading creator-name">
                                                    <a href="/users/{{ creator.creator.userprofile.slug }}" style="color: white">{{ creator.creator.get_full_name }}</a>
                                                    {% if not creator.is_owner %}
                                                        <i id="creator-{{ creator.creator.username }}-icon" class="fa fa-minus-circle pull-right"
                                                           style="color: white; padding-left: 5px;" onclick="removeCreator('{{ creator.creator.username }}', '{{ creator.creator.get_full_name }}', '{{ creator.creator.userprofile.get_thumbnail }}')">
                                                        </i>
                                                    {% endif %}
                                                </h4>

                                                <div id='{{ creator.creator.username }}'>
                                                    {% if creator.awaiting_confirmation %}
                                                        <p style="margin-bottom: 0px;"><strong>Awaiting Confirmation</strong></p>
                                                    {% endif %}
                                                </div>

                                                {% if creator.is_owner %}
                                                    <p style="margin-bottom: 10px;"><strong>Project Owner</strong></p>
                                                {% else %}
                                                    {% if creator.is_admin %}
                                                        <input type="checkbox" name="is-adimn" style="color: white; margin-bottom: 15px;" checked onchange="updateCreator('{{ creator.creator.username }}', 'admin', this.checked)">Project administrator<br>
                                                    {% else %}
                                                        <input type="checkbox" name="is-adimn" style="color: white; margin-bottom: 15px;" onchange="updateCreator('{{ creator.creator.username }}', 'admin', this.checked)">Project administrator<br>
                                                    {% endif %}
                                                {% endif %}
                                            </div>
                                        </div>

                                        <div class="row">
                                            <div id="{{ creator.creator.username }}">
                                                <div id="creator-{{ creator.creator.username }}-summary" class="creator-edit" style="margin: 0px;">
                                                    {% autoescape off %} {{ creator.summary }} {% endautoescape %}
                                                </div>
                                            </div>
                                        </div>

                                        <hr style="margin: 10px 0px 10px 0px; color: white;">
                                    </div>
                                {% endif %}
                            {% endfor %}
                        </div>
                        <div class="ui-widget row">
                            <div class="col-md-10" style="padding-left: 20px">
                                <input id="creatorInput" onkeyup="userLookupKeyup()" style="color: black; padding-left: 10px; margin-top: 15px; padding-top: 5px;" placeholder="Add a username">
                            </div>
                            <div class="col-md-2" style="padding-left: 5px; padding-top: 3px;">
                                <h4><i id="user-lookup-add" class="fa fa-plus-circle pull-left" style="color: white;" onclick="userLookup()"></i></h4>
                            </div>
                        </div>

                        <div id="add-creator"></div>

                        <div id="creator-error" class="hidden">
                            <p style="text-align: center; color: white; margin: 10px 0px 0px 0px">
                                <i class="fa fa-exclamation-circle" style="color: white;"></i>
                                <span id="creator-error-message"></span>
                            </p>
                        </div>
                    </div>
                    <br>

                    {% if context.prior_creator %}
                        <div id="prior-creators-container">
                    {% else %}
                        <div id="prior-creators-container" class="hidden">
                    {% endif %}
                            <div  class="content-box box-primary animated fadeInDown animation-delay-14">
                                <h4 class="content-box-title" style="margin-top: 0px; padding: 0px;"><strong>Prior-Contributors</strong></h4>

                                <div id="prior-creators" class="media">
                                    {% for creator in project_creators %}
                                        {% if not creator.is_active %}
                                            <div id="prior-creator-{{ creator.creator.username }}" class="creator">
                                                <div class="row">
                                                    <div class="col-md-3">
                                                        <a href="/users/{{ creator.creator.userprofile.slug }}">
                                                                <img src="{{ creator.creator.userprofile.get_thumbnail }}"
                                                                     alt="{{ creator.creator.get_full_name }}" class="img-circle" style="width: 50px; height: 50px;">
                                                        </a>
                                                    </div>
                                                    <div class="col-md-9" style="text-align: left;">
                                                        <h4 id="{{ creator.creator.username }}" class="media-heading creator-name">
                                                            <a href="/users/{{ creator.creator.userprofile.slug }}" style="color: white">{{ creator.creator.get_full_name }}</a>
                                                            <i id="creator-{{ creator.creator.username }}-icon" class="fa fa-plus-circle pull-right" style="color: white; padding-left: 5px;"
                                                                    onclick="reactivateCreator('{{ creator.creator.username }}', '{{ creator.creator.get_full_name }}', '{{ creator.creator.userprofile.get_thumbnail }}')">
                                                            </i>
                                                        </h4>
                                                    </div>
                                                </div>

                                                <div class="row">
                                                    <div id="{{ creator.creator.username }}">
                                                        <div id="creator-{{ creator.creator.username }}-summary" class="creator-edit" style="margin: 0px;">
                                                            {% autoescape off %} {{ creator.summary }} {% endautoescape %}
                                                        </div>
                                                    </div>
                                                </div>

                                                <hr style="margin: 10px 0px 10px 0px; color: white;">
                                            </div>
                                        {% endif %}
                                    {% endfor %}
                                </div>

                                <div id="prior-creator-error" class="hidden">
                                    <p style="text-align: center; color: white; margin: 10px 0px 0px 0px">
                                        <i class="fa fa-exclamation-circle" style="color: white;"></i>
                                        <span id="prior-creator-error-message"></span>
                                    </p>
                                </div>
                            </div>
                            <br>
                        </div>

                    <div class="panel panel-default animated fadeInUp animation-delay-12">
                        <div class="panel-heading"><i class="fa fa-tags"></i>Tags</div>
                        <div class="panel-body">
                            <input id="tags-input" type="text" class="label-success" value={{ project_tags }} data-role="tagsinput"
                                   style="display: none;">

                            <p id="tags-error" class="hidden">
                                <i class="fa fa-exclamation-circle" style="color: red; margin-right: 3px;"></i>
                                <span id="tags-error-message" style="color: red;"></span>
                            </p>
                        </div>
                    </div>

                    <div class="panel panel-default animated fadeInUp animation-delay-12">
                        <div class="panel-heading"><i class="fa fa-database"></i>Technologies Used</div>
                        <div class="panel-body">
                            <div class="ui-widget">
                                <div class="input-group">
                                    <input id="technologyInput" placeholder="Add a technology" onkeyup="newTechnology()" style="padding-left: 5px;">
                                    <span class="input-group-addon"><i class="fa fa-plus-circle" onclick="addTechnology()"></i></span>
                                </div>

                                <div>
                                    <p id="technology-error" class="hidden" style="color: red;">
                                        <i class="fa fa-exclamation-circle" style="color: red; margin-right: 3px;"></i>
                                        <span id="technology-error-message"></span>
                                    </p>
                                </div>

                                <div id="technologies" style="margin-top: 10px">
                                     {% for technology in project_technologies %}
                                        <div id="technology-{{ technology.technology.name }}" style="margin-bottom: 15px;">
                                            <div>
                                                <p class="addedTechnology" id="technology-{{ technology.technology.name }}-name">
                                                    {{ technology.technology.name }}
                                                    <i id="technology-{{ technology.technology.name }}-icon" class="fa fa-minus-circle"
                                                       style="color: black; padding-left: 5px;" onclick="removeTechnology('{{ technology.technology.name }}')">
                                                    </i>
                                                <p>
                                                <p id="technology-{{ technology.technology.name }}-error" class="hidden" style="color: red;">
                                                    <i class="fa fa-exclamation-circle" style="color: red; margin-right: 3px;"></i>
                                                    <span id="technology-{{ technology.technology.name }}-error-message"></span>
                                                </p>
                                            </div>
                                            <div>
                                                <div class="technology-slider" data-name="{{ technology.technology.name }}" data-strength="{{ technology.strength }}"></div>
                                            </div>
                                        </div>
                                     {% endfor %}
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="panel panel-default animated fadeInUp animation-delay-12">
                        <div class="panel-heading"><i class="fa fa-desktop"></i> Design and code</div>
                        <div class="panel-body center">
                            <p>Click to link to your project's Github account</p>

                            <p class="animated fadeIn animation-delay-7 git" data-link=("{{ project.github_repo }}")
                               style="color: transparent;" onclick="editRepoURL('github', $(this).data('link'))">
                                <i class="fa fa-github fa-3x" style="color: #2a2a2a;"></i>
                            </p>

                            <div id="div-github-repo" class="input-group hidden" style="margin-top: 15px;">
                                <input id="github-input" class="form-control" type="text" style="margin-bottom: 5px" value="{% autoescape off %}{{ project.github_repo }}{% endautoescape %}">
                                <button type="button" class="btn btn-ar btn-default"
                                        style="height: 35px; margin-left: 5px;" onclick="updateRepoURL($('#github-input').val(), 'github')">
                                    Update
                                </button>
                            </div>
                            <div id="github-repo-error" class="hidden" style="margin-top: 15px;">
                                <i class="fa fa-exclamation-circle" style="color: red;"></i>
                                <span id="github-repo-error-message" style="color: red"></span>
                            </div>

                            <div id="repo-link-error-main" class="hidden" style="margin-top: 15px;">
                                <i class="fa fa-exclamation-circle" style="color: red;"></i>
                                <span id="repo-link-error-main-message" style="color: red"></span>
                            </div>
                        </div>
                    </div>
                    <br>
                </div>
            </div>
        </form>
    </div>

    <div id="toast"></div>

{% endblock %}

{% block extra_scripts %}
    <script src="{% static "froala_editor/js/froala_editor.min.js" %}"></script>
    <script src="{% static "froala_editor/js/plugins/tables.min.js" %}"></script>
    <script src="{% static "froala_editor/js/plugins/lists.min.js" %}"></script>
    <script src="{% static "froala_editor/js/plugins/colors.min.js" %}"></script>,
    <script src="{% static "froala_editor/js/plugins/font_family.min.js" %}"></script>
    <script src="{% static "froala_editor/js/plugins/font_size.min.js" %}"></script>
    <script src="{% static "froala_editor/js/plugins/video.min.js" %}"></script>
    <script src="{% static "froala_editor/js/plugins/char_counter.min.js" %}"></script>
    <script src="{% static "js/bootstrap-tagsinput.js" %}"></script>
    <script src="//code.jquery.com/ui/1.11.4/jquery-ui.js"></script>
    <script src="{% static "js/jquery.formset.js" %}"></script>
    <script src="{% static "js/toastr.min.js" %}"></script>

    <script>
        $.Editable.DEFAULTS.key = '9uC-7G-7kmcvjfnD3kfg==';
    </script>
    <script>
        var showSaveToast = function(message) {
            toastr.options.closeButton = false;
            toastr.options.timeOut = 2000;
            toastr.options.fadeOut = 250;
            toastr.options.fadeIn = 250;
            toastr.options.positionClass = 'toast-bottom-right'

            if (message !== undefined) {
                toastr['success'](message + ' saved successful');
            }
            else {
                toastr['success']('Save successful');
            }
        };

        {% autoescape off %}
            var availableTechnologies = {{ context.technologies }},
                tags = "{{ project_tags }}";
        {% endautoescape %}

        $("#technologyInput").autocomplete({
            source: availableTechnologies
        });

        $('#tags-input').tagsinput({
            allowDuplicates: false,
        });

        var postPlaceholder = 'Create a post for your project it can include images, videos and embeded youtube content.',
            titlePlaceholder = 'Add a title for your new post';

        var LimitedCharEdit = function(element, data, url, placeholder, charCount){
            $(element).editable({
                imageUpload: false,
                imageLink: false,
                buttons: [],
                saveParams: {
                    csrfmiddlewaretoken: '{{ csrf_token }}',
                    data: JSON.stringify(data),
                    project: {{ context.projectId }},
                },
                saveURL: url,
                autosave: true,
                autosaveInterval: 2500,
                crossDomain: false,
                placeholder: placeholder,
                maxCharacters: charCount,
            }).on('editable.afterSave', function (e, editor, data) {
                showSaveToast();
            });};

        var simpleEdit = function(element, data, url, placeholder){
            $(element).editable({
                imageUpload: false,
                imageLink: false,
                buttons: [],
                saveParams: {
                    csrfmiddlewaretoken: '{{ csrf_token }}',
                    data: JSON.stringify(data),
                    project: {{ context.projectId }},
                },
                saveURL: url,
                autosave: true,
                autosaveInterval: 2500,
                crossDomain: false,
                placeholder: placeholder
            }).on('editable.afterSave', function (e, editor, data) {
                showSaveToast();
            });};

        var richEdit = function(element, data, url, placeholder){
            $(element).editable({
                inlineMode: false,
                buttons: ['save', 'undo', 'redo', 'removeFormat', 'bold', 'italic', 'underline', 'strikeThrough', 'color', 'fontFamily',
                          'fontSize',  'formatBlock', 'inlineStyle', 'align', 'insertOrderedList',
                          'insertUnorderedList', 'outdent', 'indent', 'createLink', 'insertImage',
                          'insertVideo', 'table', 'insertHorizontalRule' ],
                saveParams: {
                    csrfmiddlewaretoken: '{{ csrf_token }}',
                    data: JSON.stringify(data),
                    project: {{ context.projectId }},
                },
                saveURL: url,
                autosave: true,
                autosaveInterval: 2500,
                crossDomain: false,
                placeholder: placeholder,
                pasteImage: false,
                pastedImagesUploadURL: '{% url 'project_image_upload' %}',
                pastedImagesUploadRequestType: 'POST',
                imageMove: true,
                imageUpload: true,
                imageUploadParam: 'file',
                imageUploadURL: '{% url 'project_image_upload' %}',
                imageUploadParams: {
                    csrfmiddlewaretoken: '{{ csrf_token }}',
                    project: {{ context.projectId }},
                },
                imageDeleteConfirmation: true,
                imageDeleteParams: {
                    csrfmiddlewaretoken: '{{ csrf_token }}',
                    project: {{ context.projectId }},
                },
                imageDeleteURL: '{% url 'project_image_delete' %}',
            })

            // Catch image remove
            .on('editable.afterRemoveImage', function (e, editor, $img) {
                // Set the image source to the image delete params.
                editor.options.imageDeleteParams.src = $img.attr('src');

                // Make the delete request.
                editor.deleteImage($img);
            })

            .on('editable.afterSave', function (e, editor, data) {
                showSaveToast();
            });
        };

        var logoRemoved = function () {
            $("#logo").remove();
            $("#logo-image").append('<img id="logo" class="logo" src="{% static "images/add-a-logo.png" %}" alt="Logo" width="200" style="padding-bottom: 15px;"/>');

            $('.logo').editable({imageUpload: true,
                imageUploadParam: 'file',
                imageUploadURL: '{% url 'project_image_upload' %}',
                imageUploadParams: {
                    logo: true,
                    csrfmiddlewaretoken: '{{ csrf_token }}',
                    project: {{ context.projectId }},
                },
                imageButtons: ['replaceImage', 'removeImage'],
                imageDeleteConfirmation: false,
                imageDeleteURL: '{% url 'project_image_delete' %}',
                imageDeleteParams: {
                    logo: true,
                    csrfmiddlewaretoken: '{{ csrf_token }}',
                    project: {{ context.projectId }},
                },
                placeholder: '{% static "images/add-a-logo.png" %}',
                crossDomain: false
            }).on('editable.beforeRemoveImage', function (e, editor, $img) {
                console.log('before');
                // Set the image source to the image delete params.
                editor.options.imageDeleteParams.src = $img.attr('src');

                // Make the delete request.
                editor.deleteImage($img);

                $img.attr.src = editor.options.placeholder;

                logoRemoved();
                $(".logo").on("remove", logoRemoved());
            }).on('editable.afterSave', function (e, editor, data) {
                showSaveToast('Logo');
            });
        };

        $(function(){
            $('.logo').editable({imageUpload: true,
                imageUploadParam: 'file',
                imageUploadURL: '{% url 'project_image_upload' %}',
                imageUploadParams: {
                    logo: true,
                    csrfmiddlewaretoken: '{{ csrf_token }}',
                    project: {{ context.projectId }},
                },
                imageButtons: ['replaceImage', 'removeImage'],
                imageDeleteConfirmation: false,
                imageDeleteURL: '{% url 'project_image_delete' %}',
                imageDeleteParams: {
                    logo: true,
                    csrfmiddlewaretoken: '{{ csrf_token }}',
                    project: {{ context.projectId }},
                },
                placeholder: '{% static "images/add-a-logo.png" %}',
                crossDomain: false
            }).on('editable.beforeRemoveImage', function (e, editor, $img) {
    {#           Todo get aftre remove image working and refactor logo removed #}
                console.log('before');
                // Set the image source to the image delete params.
                editor.options.imageDeleteParams.src = $img.attr('src');

                // Make the delete request.
                editor.deleteImage($img);

                $img.attr.src = editor.options.placeholder;

                logoRemoved();
            }).on('editable.afterSave', function (e, editor, data) {
                showSaveToast('Logo');
            });
        });

        var addPost = function () {
            $.ajax({
                    url: "{% url 'add_post' %}",
                    type: 'POST',
                    dataType: 'json',
                    data: {
                            project: {{ context.projectId }},
                            csrfmiddlewaretoken: '{{ csrf_token }}'
                    },
                    success: function (data, textStatus, xhr) {
                        if (data.status == 401) {
                            window.location.href = window.location.pathname.substring( 0, window.location.pathname.indexOf( '/' ) + 1 ) + data.redirect
                        }
                        else if (data.status === 500) {
                            $('#add-post-errors').removeClass('hidden');
                            $('#add-post-errors-message').html('Internal server error, please try again later.');
                        }
                        else if (data.content.success === true) {
                            $('#add-post-errors').addClass('hidden');

                            $("#time-line").prepend(
                                '<br/>' +
                                '<li class="animated fadeInRight animation-delay-2">' +
                                    '<time class="timeline-time" datetime="">' + data.content.date_added + '</time>' +
                                    '<i class="timeline-2-point"></i>' +
                                    '<div class="panel panel-default">' +
                                        '<div class="panel-heading">' +
                                            '<div id="' + data.content.post_id + '" class="new-post-title-edit" style="color: black;"></div>' +
                                        '</div>' +
                                        '<div id="' + data.content.post_id + '" class="new-post-edit"></div>' +
                                        '<div style="padding: 5px;">' +
                                            '<div style="display: inline-block">' +
                                                '<label>Author </label>' +
                                                '<select id="' + data.content.username + '-user-selection" class="user-selection" selected="' + data.content.username + '" onchange="updatePost(' + data.content.post_id + ', "author", $(this.selectedOptions[0]).val())">' +
                                                '</select>' +
                                            '</div>' +
                                            '<div class="pull-right">' +
                                                '<input type="checkbox" name="' + data.content.post_id + '-is-adimn" onchange="updatePost(' + data.content.post_id + ', &apos;published&apos;, this.checked)">Publish post<br>' +
                                            '</div>' +
                                            '<div id="update-post-errors" class="hidden">' +
                                                '<p style="text-align: center; color: red;">' +
                                                    '<i class="fa fa-exclamation-circle" style="color: red;"></i>' +
                                                    '<span id="update-post-errors-message"></span>' +
                                                '</p>' +
                                            '</div>' +
                                        '</div>' +
                                    '</div>' +
                                '</li>'
                            );

                            var authors = $('#' + data.content.username + '-user-selection');
                            $('.creator-name').each(function(){
                                $(authors).append('<option value=' + this.id + '>' + (this.childNodes[1]).text + '</option>')
                            });

                            $('.new-post-title-edit').each(function() {
                                simpleEdit($(this), {'field': 'title', 'post': data.content.post_id}, "{% url 'update_post' %}", titlePlaceholder)
                            });
                            $('.new-post-edit').each(function() {
                                richEdit($(this), {'field': 'post', 'post': data.content.post_id}, "{% url 'update_post' %}", postPlaceholder)
                            });

                            $('.new-post-title-edit').find('.fr-placeholder').each(function() {
                                $(this).css('color', 'black');
                            });
                        }
                        else {
                            $('#add-post-errors').removeClass('hidden');
                            $('#add-post-errors-message').text(data.content.message);
                        }
                    },
                    error: function (xhr, textStatus, errorThrown) {
                        $('#add-post-errors').removeClass('hidden');
                        $('#add-post-errors-message').text(xhr.responseJSON.message);
                    }
                });
        };

        var updatePost = function (post, field, value) {
            $.ajax({
                    url: "{% url 'update_post' %}",
                    type: 'POST',
                    dataType: 'json',
                    data: {data: JSON.stringify({'field': field, 'value': value, 'post':  post}),
                           project: {{ context.projectId }},
                           csrfmiddlewaretoken: '{{ csrf_token }}'},
                    success: function (data, textStatus, xhr) {
                        if (data.status === 401) {
                            window.location.href = window.location.pathname.substring( 0, window.location.pathname.indexOf( '/' ) + 1 ) + data.redirect
                        }
                        else if (data.status === 500) {
                            $('#update-post-errors').removeClass('hidden');
                            $('#update-post-errors-message').text('Internal server error, please try again later.');
                        }
                        else if (data.content.success === true) {
                            $('#update-post-errors').addClass('hidden');
                            showSaveToast('Post');
                        }
                        else {
                            $('#update-post-errors').removeClass('hidden');
                            $('#update-post-errors-message').text(data.content.message);
                        }
                    },
                    error: function (xhr, textStatus, errorThrown) {
                        $('#update-post-errors').removeClass('hidden');
                        $('#update-post-errors-message').text(xhr.responseJSON.message);
                    }
                });
        };

        var userLookupKeyup = function () {
            if (event.keyCode == 13) {
                userLookup();
            }
        };

        var userLookup = function (username) {
            var username = $('#creatorInput').val();

            if (username.length > 0) {
                $.ajax({
                    url: "{% url 'get_user' %}",
                    type: 'POST',
                    dataType: 'json',
                    data: {username: username,
                           csrfmiddlewaretoken: '{{ csrf_token }}'},
                    success: function (data, textStatus, xhr) {
                        if (data.status == 401) {
                            window.location.href = window.location.pathname.substring( 0, window.location.pathname.indexOf( '/' ) + 1 ) + data.redirect
                        }
                        else if (data.status === 500) {
                            $('#creator-error').removeClass('hidden');
                            $('#creator-error-message').text('Internal server error, please try again later.');
                        }
                        else if (data.success === true) {
                            $('#creator-error').addClass('hidden');

                            var new_creators = $('#add-creator');

                            new_creators.html('<div id="new-creator-div" style="margin-top: 15px;">' +
                                                '<a class="pull-left" href="#">' +
                                                    '<img src="' + data.thumbnail + '" alt="' + data.full_name + '" class="img-circle" style="width: 50px">' +
                                                '</a>' +
                                                '<h4 class="media-heading"><a href="#" style="color: white">' + data.full_name + '</a></h4>' +
                                                '<a class="btn btn-default btn-sm" onClick="addCreator(&quot;' + data.username +'&quot;, &quot;' + data.thumbnail + '&quot;, &quot;' + data.full_name + '&quot;)" style="margin-top: 5px">Add Creator</a>' +
                                              '</div>');
                        }
                        else {
                            $('#creator-error').removeClass('hidden');
                            $('#creator-error-message').text(data.message);
                        }
                    },
                    error: function (xhr, textStatus, errorThrown) {
                        $('#creator-error').removeClass('hidden');
                        $('#creator-error-message').text(xhr.responseJSON.message);
                    }
                });
            }
            else {
                $('#creator-error').removeClass('hidden');
                $('#creator-error-message').html('Please provide a username');
            }

            $('#creatorInput').val('');
        };

        var getNewCreatorElements = function(username, fullname, thumbnail, parentId) {
             return '<div id="' + parentId + '" class="creator"> \
                         <div class="row"> \
                            <div class="col-md-3"> \
                                <a class="pull-left" href="#"> \
                                <img src="' + thumbnail + '" alt="' + fullname + '" class="img-circle" style="width: 50px; height: 50px;"> \
                                </a> \
                            </div> \
                            <div class="col-md-9" style="text-align: left;"> \
                                <h4 id="' + username + '-heading" class="media-heading creator-name"><a href="#" style="color: white">' + fullname + '</a> \
                                </h4> \
                                <p style="margin-bottom: 0px;"><strong>Awaiting Confirmation</strong></p> \
                                <input type="checkbox" name="is-adimn" style="color: white; onchange="updateCreator(&apos;'+ username +'&apos;, &apos;admin&apos;, this.checked)"">Project administrator<br> \
                            </div> \
                         </div> \
                         <div class="row"> \
                            <div id="creator-' + username + '-summary" class="creator-edit" name="' + username + '" style="margin-bottom: 0px;"></div> \
                         </div> \
                         <hr style="margin: 10px 0px 0px 0px; color: white;"> \
                    </div> ';
        }


        var reactivateCreator = function (username, fullname, thumbnail) {
            $.ajax({
                    url: "{% url 'update_creator' %}",
                    type: 'POST',
                    dataType: 'json',
                    data: {username: username,
                           field: 'active',
                           value: true,
                           project: {{ context.projectId }},
                           csrfmiddlewaretoken: '{{ csrf_token }}'},
                    success: function (data, textStatus, xhr) {
                        if (data.status == 401) {
                            window.location.href = window.location.pathname.substring( 0, window.location.pathname.indexOf( '/' ) + 1 ) + data.redirect
                        }
                        else if (data.status === 500) {
                            $('#prior-creator-error').removeClass('hidden');
                            $('#prior-creator-error-message').text('Internal server error, please try again later.');
                        }
                        else if (data.content.success === true) {
                            $('#prior-creator-error').addClass('hidden');
                            var summary = $('#creator-' + username + '-summary'),
                                creators = $('#creators');

                            creators.append(getNewCreatorElements(username, fullname, thumbnail, 'creator-' + username));
                            var header = $('#' + username + '-heading');
                            header.append('<i id="creator-' + username + '-icon" class="fa fa-minus-circle pull-right" style="color: white; padding-left: 5px;" onclick="removeCreator(&apos;' + username + '&apos;, &apos;' + fullname + '&apos;, &apos;' + thumbnail + '&apos;)"> </i>')

                            var newSummary = creators.find('#creator-' + username + '-summary');
                            newSummary.append(summary);

                            $('#prior-creator-' + username).remove()

                            var priorCreatorsContainer = $('#prior-creators-container'),
                                priorCreators = priorCreatorsContainer.find('.creator');

                            if (priorCreators.length === 0 ){
                                priorCreatorsContainer.addClass('hidden');
                            }

                            showSaveToast('Creator');
                        }
                        else {
                            $('#prior-creator-error').removeClass('hidden');
                            $('#prior-creator-error-message').text(data.content.message);
                        }
                    },
                    error: function (xhr, textStatus, errorThrown) {
                        $('#prior-creator-error').removeClass('hidden');
                        $('#prior-creator-error-message').text(xhr.responseJSON.message);
                    }
            });
        };

        var updateCreator = function (username, field, value) {
            $.ajax({
                    url: "{% url 'update_creator' %}",
                    type: 'POST',
                    dataType: 'json',
                    data: {username: username,
                           field: field,
                           value: value,
                           project: {{ context.projectId }},
                           csrfmiddlewaretoken: '{{ csrf_token }}'},
                    success: function (data, textStatus, xhr) {
                        if (data.status == 401) {
                            window.location.href = window.location.pathname.substring( 0, window.location.pathname.indexOf( '/' ) + 1 ) + data.redirect
                        }
                        else if (data.status === 500) {
                            $('#creator-error').removeClass('hidden');
                            $('#creator-error-message').text('Internal server error, please try again later.');
                        }
                        else if (data.content.success === true) {
                            $('#creator-error').addClass('hidden');
                            showSaveToast('Creator');
                        }
                        else {
                            $('#creator-error').removeClass('hidden');
                            $('#creator-error-message').text(data.content.message);
                        }
                    },
                    error: function (xhr, textStatus, errorThrown) {
                        $('#creator-error').removeClass('hidden');
                        $('#creator-error-message').text(xhr.responseJSON.message);
                    }
            });
        };

        var removeCreator = function (username, fullname, thumbnail) {
            $.ajax({
                    url: "{% url 'remove_creator_from_project' %}",
                    type: 'POST',
                    dataType: 'json',
                    data: {username: username,
                           project: {{ context.projectId }},
                           csrfmiddlewaretoken: '{{ csrf_token }}'},
                    success: function (data, textStatus, xhr) {
                        if (data.status == 401) {
                            window.location.href = window.location.pathname.substring( 0, window.location.pathname.indexOf( '/' ) + 1 ) + data.redirect
                        }
                        else if (data.status === 500) {
                            $('#creator-error').removeClass('hidden');
                            $('#creator-error-message').text('Internal server error, please try again later.');
                        }
                        else if (data.content.success === true) {
                            $('#prior-creators-container').removeClass('hidden');

                            $('#creator-error').addClass('hidden');
                            var summary = $('#creator-' + username + '-summary'),
                                creators = $('#prior-creators');

                            creators.append(getNewCreatorElements(username, fullname, thumbnail, 'prior-creator-' + username));

                            var newSummary = creators.find('#creator-' + username + '-summary');
                            newSummary.append(summary);

                            $('#creator-' + username).remove()

                            var header = $('#' + username + '-heading');
                            header.append('<i id="creator-' + username + '-icon" class="fa fa-plus-circle pull-right" style="color: white; padding-left: 5px;" onclick="reactivateCreator(&apos;' + username + '&apos;, &apos;' + fullname + '&apos;, &apos;' + thumbnail + '&apos;)"> </i>')

                            showSaveToast('Creator');
                        }
                        else {
                            $('#creator-error').removeClass('hidden');
                            $('#creator-error-message').text(data.content.message);
                        }
                    },
                    error: function (xhr, textStatus, errorThrown) {
                        $('#creator-error').removeClass('hidden');
                        $('#creator-error-message').text(xhr.responseJSON.message);
                    }
                });
        };

        var addCreator = function (username, thumbnail, fullName) {
            if (username.length > 0) {
                $.ajax({
                    url: "{% url 'add_creator_to_project' %}",
                    type: 'POST',
                    dataType: 'json',
                    data: {username: username,
                           project: {{ context.projectId }},
                           csrfmiddlewaretoken: '{{ csrf_token }}'},
                    success: function (data, textStatus, xhr) {
                        if (data.status == 401) {
                            window.location.href = window.location.pathname.substring( 0, window.location.pathname.indexOf( '/' ) + 1 ) + data.redirect
                        }
                         else if (data.status === 500) {
                            $('#creator-error').removeClass('hidden');
                            $('#creator-error-message').text('Internal server error, please try again later.');
                        }
                        else if (data.content.success === true) {
                            $('#creator-error').addClass('hidden');

                            var creators = $('#creators');

                            creators.append(getNewCreatorElements(username, fullName, thumbnail, 'creator-' + username));

                            var header = $('#' + username + '-heading');
                            header.append('<i id="creator-' + username + '-icon" class="fa fa-minus-circle pull-right" style="color: white; padding-left: 5px;" onclick="removeCreator(&apos;' + username + '&apos;, &apos;' + fullName + '&apos;, &apos;' + thumbnail + '&apos;)"> </i>')

                            $('#new-creator-div').remove()

                            $('#creator-' + username + '-summary').editable({
                                imageUpload: false,
                                imageLink: false,
                                buttons: ['bold', 'italic', 'underline', 'fontSize', 'sep', 'formatBlock',
                                          'blockStyle', 'align',  'outdent', 'indent', 'sep', 'undo', 'redo'],
                                saveParams: {
                                    csrfmiddlewaretoken: '{{ csrf_token }}',
                                    field: 'summary',
                                    project: {{ context.projectId }},
                                    username: username
                                },
                                saveURL: "{% url 'update_creator' %}",
                                autosave: true,
                                autosaveInterval: 2500,
                                crossDomain: false,
                                placeholder: "Add a description of this creator's contribution"
                            });

                            $('.user-selection').each(function() {
                                $(this).append('<option value='+ username + '>' + fullName + '</option>')
                            })

                            $('.creator-edit').find('.fr-placeholder').each(function() {
                                $(this).css('color', 'white');
                            });

                            showSaveToast('Creator');
                        }
                        else {
                            $('#creator-error').removeClass('hidden');
                            $('#creator-error-message').text(data.content.message);
                        }
                    },
                    error: function (xhr, textStatus, errorThrown) {
                        $('#creator-error').removeClass('hidden');
                        $('#creator-error-message').text(xhr.responseJSON.message);
                    }
                });
            }
            else {
                $('#creator-error').removeClass('hidden');
                $('#creator-error-message').text('Please provide a username');
            }

            $('#creatorInput').val('');
            $('#addCreator').addClass('hidden');
        };

        var newTechnology = function () {
            $('#addTechnology').removeClass('hidden');

            if (event.keyCode == 13) {
                addTechnology();
            }
        };

        var addTechnology = function () {
            var raw = $('#technologyInput').val(),
                value = raw.substr(0, 1).toUpperCase() + raw.substr(1);

            $.ajax({
                url: "{% url 'add_technology_to_project' %}",
                type: 'POST',
                dataType: 'json',
                data: {technology: value,
                       project: {{ context.projectId }},
                       csrfmiddlewaretoken: '{{ csrf_token }}'},
                success: function (data, textStatus, xhr) {
                    if (data.status == 401) {
                            location.href = data.redirect
                    }
                    else if (data.status === 500) {
                        $('#technology-error').removeClass('hidden');
                        $('#technology-error-message').text('Internal server error, please try again later.');
                    }
                    else if (data.content.success === true) {
                        $('#technology-error-message').addClass('hidden');

                        $('#technologies').append('<div id="technology-' + value + '" style="margin-bottom: 15px;">' +
                                                    '<div>' +
                                                        '<p class="addedTechnology" id="technology-' + value + '-name">' +
                                                            '' + value + '' +
                                                            '<i id="technology-' + value + '-icon" class="fa fa-minus-circle" style="color: black; padding-left: 5px;" onclick="removeTechnology(&apos;' + value + '&apos;)"></i>' +
                                                        '<p>' +
                                                        '<p id="technology-' + value + '-error" class="hidden" style="text-align: center; color: red;">' +
                                                            '<i class="fa fa-exclamation-circle" style="color: red;"></i>' +
                                                            '<span id="technology-' + value + '-error-message"></span>' +
                                                        '</p>' +
                                                    '</div>' +
                                                    '<div>' +
                                                        '<div id="' + value + '-slider" class="technology-slider" data-name="' + value + '" data-strength="0"></div>' +
                                                    '</div>' +
                                                '</div>');
                        $('#' + value + '-slider').slider({
                            min: 0,
                            max: 100,
                            value: 0,
                            change: function (event, ui) {
                                updateTechnology(value, $(this).slider( "value" ));
                            }
                        });
                        $('#technologyInput').val('');
                    }
                    else {
                        $('#technology-error').removeClass('hidden');
                        $('#technology-error-message').text(data.content.message);
                    }

                    showSaveToast('Technology');
                },
                error: function (xhr, textStatus, errorThrown) {
                    $('#technology-error').removeClass('hidden');
                    $('#technology-error-message').text(xhr.responseJSON.message);
                }
            });
        };

        var removeTechnology = function (value) {
             $.ajax({
                url: "{% url 'remove_technology_from_project' %}",
                type: 'POST',
                dataType: 'json',
                data: {technology: value,
                       project: {{ context.projectId }},
                       csrfmiddlewaretoken: '{{ csrf_token }}'},
                success: function (data, textStatus, xhr) {
                    if (data.status == 401) {
                        window.location.href = window.location.pathname.substring( 0, window.location.pathname.indexOf( '/' ) + 1 ) + data.redirect
                    }
                    else if (data.status === 500) {
                        $('#technology-' + value + '-error').removeClass('hidden');
                        $('#technology-' + value + '-error-message').text('Internal server error, please try again later.');
                    }
                    else if (data.content.success === true) {
                        $('#technology-' + value).remove();
                        showSaveToast('Technology');
                    }
                    else {
                        $('#technology-' + value + '-error').removeClass('hidden');
                        $('#technology-' + value + '-error-message').text(data.content.message);
                    }
                },
                error: function (xhr, textStatus, errorThrown) {
                    $('#technology-' + value + '-error').removeClass('hidden');
                    $('#technology-' + value + '-error-message').text(xhr.responseJSON.message);
                }
            });
        };

        var updateTechnology = function (name, strength) {
             $.ajax({
                url: "{% url 'update_project_technology' %}",
                type: 'POST',
                dataType: 'json',
                data: {technology: name,
                       strength: strength,
                       project: {{ context.projectId }},
                       csrfmiddlewaretoken: '{{ csrf_token }}'},
                success: function (data, textStatus, xhr) {
                    if (data.status == 401) {
                        window.location.href = window.location.pathname.substring( 0, window.location.pathname.indexOf( '/' ) + 1 ) + data.redirect
                    }
                    else if (data.status === 500) {
                        $('#technology-' + name + '-error').removeClass('hidden');
                        $('#technology-' + name + '-error-message').text('Internal server error, please try again later.');
                    }
                    else if (data.content.success !== true) {
                        $('#technology-' + name + '-error').removeClass('hidden');
                        $('#technology-' + name + '-error-message').text(data.content.message);
                    }
                    showSaveToast('Technology');
                },
                error: function (xhr, textStatus, errorThrown) {
                    $('#technology-' + name + '-error').removeClass('hidden');
                    $('#technology-' + name + '-error-message').text(xhr.responseJSON.message);
                }
            });
        };

        $('#tags-input').on('beforeItemAdd', function(event) {
                $.ajax({
                    url: "{% url 'add_tag_to_project' %}",
                    type: 'POST',
                    dataType: 'json',
                    data: {tag: event.item,
                           project: {{ context.projectId }},
                           csrfmiddlewaretoken: '{{ csrf_token }}'},
                    success: function (data, textStatus, xhr) {
                        if (data.status == 401) {
                            window.location.href = window.location.pathname.substring( 0, window.location.pathname.indexOf( '/' ) + 1 ) + data.redirect
                        }
                        else if (data.status === 500) {
                            $('#tags-error').removeClass('hidden');
                            $('#tags-error-message').text('Internal server error, please try again later.');
                        }
                        else if (data.content.success === true) {
                            $('#tags-error').addClass('hidden')
                        }
                        else {
                            $('tags-input').tagsinput('remove', event.item);
                            $('#tags-error').removeClass('hidden')
                            $('#tags-error-message').text(data.content.message);
                        }

                        showSaveToast('Tag');
                    },
                    error: function (xhr, textStatus, errorThrown) {
                        $('tags-input').tagsinput('remove', event.item);
                        $('#tags-error').removeClass('hidden');
                        $('#tags-error-message').text(xhr.responseJSON.message);
                    }
                });
        });

        $('#tags-input').on('beforeItemRemove', function(event) {
            $.ajax({
                url: "{% url 'remove_tag_from_project' %}",
                type: 'POST',
                dataType: 'json',
                data: {tag: event.item,
                       project: {{ context.projectId }},
                       csrfmiddlewaretoken: '{{ csrf_token }}'},
                success: function (data, textStatus, xhr) {
                    if (data.status == 401) {
                        window.location.href = window.location.pathname.substring( 0, window.location.pathname.indexOf( '/' ) + 1 ) + data.redirect
                    }
                    else if (data.status === 500) {
                        $('#tags-error').removeClass('hidden');
                        $('#tags-error-message').text('Internal server error, please try again later.');
                    }
                    else if (data.content.success === true) {
                        $('#tags-error').addClass('hidden')
                    }
                    else {
                        $('tags-input').tagsinput('add', event.item);
                        $('#tags-error').removeClass('hidden')
                        $('#tags-error-message').text(data.content.message);
                    }

                    showSaveToast('Tag');
                },
                error: function (xhr, textStatus, errorThrown) {
                    $('tags-input').tagsinput('add', event.item);
                    $('#tags-error-message').removeClass('hidden');
                    $('#tags-error-message').text(xhr.responseJSON.message);
                }
            });
        });

        var updateProject = function (data) {
            $.ajax({
                    url: "{% url 'update_project' %}",
                    type: 'POST',
                    dataType: 'json',
                    data: {data: JSON.stringify(data),
                           project: {{ context.projectId }},
                           csrfmiddlewaretoken: '{{ csrf_token }}'},
                    success: function (data, textStatus, xhr) {
                       if (data.status == 401) {
                            window.location.href = window.location.pathname.substring(0, window.location.pathname.indexOf( '/' ) + 1 ) + data.redirect
                       }
                       else if (data.status === 500) {
                            $('#social-link-error-main').removeClass('hidden');
                            $('#social-link-error-main-message').text('Internal server error, please try again later.');
                       }
                       else if (data.content.success === true) {
                           $('#social-link-error-main').addClass('hidden');
                       }
                       else {
                            $('#social-link-error-main').removeClass('hidden');
                            $('#social-link-error-main-message').text(data.content.message);
                       }
                    },
                    error: function (xhr, textStatus, errorThrown) {
                        $('#social-link-error-main').removeClass('hidden');
                        $('#social-link-error-main-message').text(xhr.responseJSON.message);
                    }
                });
        };

        var editRepoURL = function (name, link) {
            var input = $('#' + name + '-input');

            if (input.val() == '') {
                if (link === '("")') {
                    input.val('https://github.com/')
                }
                else {
                    input.val(link);
                }
            }

            $('#div-' + name + '-repo').removeClass('hidden');
        };

        var updateRepoURL = function (link, name) {
            var input = $('#id_' + name),
                icon = $('#link-' + name),
                inputDiv = $('#div-' + name + '-repo'),
                errorMessageDiv = $('#' + name + '-repo-error'),
                valid = false;

            if ((link.startsWith('http://www.' + name + '.com/')
                        || link.startsWith('https://www.' + name + '.com/')
                        || link.startsWith('www.' + name + '.com/'))
                        || (link.startsWith('http://' + name + '.com/')
                        || link.startsWith('https://' + name + '.com/')
                        || link.startsWith(name + '.com/'))
                      && (!link.endsWith('.com/') && !link.endsWith('.com'))){
                valid = true;
            }

            if (valid) {
                inputDiv.addClass('hidden');

                updateRepo({'field': name, 'value': link})

                inputDiv.removeClass('has-error');
                errorMessageDiv.addClass('hidden');
            }
            else {
                inputDiv.addClass('has-error');

                var errorMessage = $('#' + name + '-repo-error-message');
                errorMessage.text('Please enter a valid ' + name + ' link')

                errorMessageDiv.removeClass('hidden');
            }
        };

        var updateRepo = function (data) {
            $.ajax({
                    url: "{% url 'update_repo' %}",
                    type: 'POST',
                    dataType: 'json',
                    data: {data: JSON.stringify(data),
                           project: {{ context.projectId }},
                           csrfmiddlewaretoken: '{{ csrf_token }}'},
                    success: function (data, textStatus, xhr) {
                       if (data.status == 401) {
                            window.location.href = window.location.pathname.substring(0, window.location.pathname.indexOf( '/' ) + 1 ) + data.redirect
                       }
                       else if (data.status === 500) {
                            $('#repo-link-error-main').removeClass('hidden');
                            $('#repo-link-error-main-message').text('Internal server error, please try again later.');
                       }
                       else if (data.content.success === true) {
                           $('#repo-link-error-main').addClass('hidden')
                           showSaveToast('Repository');
                       }
                       else {
                            $('#repo-link-error-main').removeClass('hidden');
                            $('#repo-link-error-main-message').text(data.content.message);
                       }
                    },
                    error: function (xhr, textStatus, errorThrown) {
                        $('#repo-link-error-main').removeClass('hidden')
                        $('#repo-link-error-main-message').text(xhr.responseJSON.message);
                    }
                });
        };

        var editSocialURL = function (name, link) {
            var input = $('#id_' + name);
            if (input.val() == '') {
                input.val(link);
            }

            $('#div-' + name ).removeClass('hidden');
        };

        var updateSocialKeyUp = function (name) {
            if (event.keyCode == 13) {
                updateSocialURL(name);
            }
        };

        var updateSocialURL = function (name) {
            var input = $('#id_' + name),
                    link = input.val(),
                    icon = $('#link-' + name),
                    inputDiv = $('#div-' + name),
                    errorMessageDiv = $('#social-link-error'),
                    errorMesage = $('#social-link-error-' + name),
                    valid = false;

            if (name === 'google-plus'
                    && (link.startsWith('http://plus.google.com/')
                        || link.startsWith('https://plus.google.com/')
                        || link.startsWith('www.plus.google.com/'))
                    && (!link.endsWith('.com/') && !link.endsWith('.com'))){
                valid = true;
            }
            else if ((link.startsWith('http://www.' + name + '.com/')
                        || link.startsWith('https://www.' + name + '.com/')
                        || link.startsWith('www.' + name + '.com/'))
                      && (!link.endsWith('.com/') && !link.endsWith('.com'))){
                valid = true;
            }

            if (valid) {
                $('#div-' + name).addClass('hidden');

                icon.removeClass('grey');
                icon.addClass(name);

                updateProject({'field': name, 'value': link})

                inputDiv.removeClass('has-error');
                errorMesage.addClass('hidden');
            }
            else {
                inputDiv.addClass('has-error');

                errorMessageDiv.removeClass('hidden');
                errorMesage.removeClass('hidden');
            }
        };

        $("#id_facebook").keyup(function () {
            updateSocialKeyUp('facebook');
        });
        $("#id_google-plus").keyup(function () {
            updateSocialKeyUp('google-plus');
        });
        $("#id_instagram").keyup(function () {
            updateSocialKeyUp('instagram');
        });
        $("#id_pinterest").keyup(function () {
            updateSocialKeyUp('pinterest');
        });
        $("#id_twitter").keyup(function () {
            updateSocialKeyUp('twitter');
        });

        $('.creator-edit').each(function(){
            $(this).editable({
                imageUpload: false,
                imageLink: false,
                buttons: ['bold', 'italic', 'underline', 'fontSize', 'sep', 'formatBlock',
                          'blockStyle', 'align',  'outdent', 'indent', 'sep', 'undo', 'redo'],
                saveParams: {
                    csrfmiddlewaretoken: '{{ csrf_token }}',
                    field: 'summary',
                    project: {{ context.projectId }},
                    username: this.parentElement.id
                },
                saveURL: "{% url 'update_creator' %}",
                autosave: true,
                autosaveInterval: 2500,
                crossDomain: false,
                placeholder: "Add a description of this creator's contribution"
            });
        });

        $('.technology-slider').each(function() {
            $(this).slider({
                min: 0,
                max: 100,
                value: $(this).data("strength"),
                change: function (event, ui) {
                    updateTechnology($(this).data("name"), $(this).slider( "value" ));
                }
            });
        });

        $('.pitch-edit').each(function() {
            simpleEdit($(this), {'field': 'pitch'}, "{% url 'update_project' %}", 'Create a pitch for your project it can include images, videos and embeded youtube content')
        });
        $('.project-tagline').each(function() {
            LimitedCharEdit($(this),  {'field': 'tagline'}, "{% url 'update_project' %}", 'Provide a tag line for your project', 128)
        });
        $('.project-title').each(function() {
            LimitedCharEdit($(this),  {'field': 'title'}, "{% url 'update_project' %}", 'Name your project', 64)
        });

        $('.post-title-edit').each(function() {
            simpleEdit($(this),  {'field': 'title', 'post': this.id}, "{% url 'update_post' %}", titlePlaceholder)
        });
        $('.post-edit').each(function() {
            richEdit($(this), {'field': 'post', 'post': this.id}, "{% url 'update_post' %}", postPlaceholder)
        });

        $('.post-title-edit').find('.fr-placeholder').each(function() {
            $(this).css('color', 'black');
        });

        $('.creator-edit').find('.fr-placeholder').each(function() {
            $(this).css('color', 'white');
        });

        toastr.options.closeButton = true;
        toastr.options.timeOut = 10000;
        toastr.options.fadeOut = 250;
        toastr.options.fadeIn = 250;
        toastr.options.positionClass = 'toast-bottom-right';
        toastr['info']("To edit your project simply click on the element you would like to change and start making your update.", "Updating you project");

    </script>

{% endblock %}


