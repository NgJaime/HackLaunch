{% extends "base.html" %}
{% load staticfiles %}
{% load widget_tweaks %}
{% block title %}HackLaunch - Edit Project{% endblock %}

{% block events-nav %}active{% endblock %}

{% block extra_css %}
    <link href="{% static "css/bootstrap-tagsinput.css" %}" media="all" rel="stylesheet" type="text/css"/>
    <link href="{% static "froala_editor/css/font-awesome.min.css" %}" media="all" rel="stylesheet" type="text/css"/>
    <link href="{% static "froala_editor/css/froala_editor.min.css" %}" media="all" rel="stylesheet" type="text/css"/>
    <link href="{% static "froala_editor/css/froala_style.min.css" %}" media="all" rel="stylesheet" type="text/css"/>
    <link rel="stylesheet" href="//code.jquery.com/ui/1.11.4/themes/smoothness/jquery-ui.css">
    <script src="{% static "js/jquery.min.js" %}"></script>
{% endblock %}

{% block content %}
    <div class="container">
        <div class="row">
            <div class="col-md-12" style="padding-top: 25px;">
                <div class="title animated fadeInDown animation-delay-5" style="padding: 10px; margin: 0px;">
                    <img class='logo' src="{% static "images/add-a-logo.png" %}" alt="Logo" width="200" style="padding-bottom: 15px;"/>
                    {% render_field form.title style="margin-bottom: 0px;" %}
                </div>
                <p class="slogan text-center no-margin-bottom">
                    {{ form.tag_line }}
                </p>
            </div>

            <div class="col-md-12 center">
                <div class="small-margin-bottom fadeInDown animation-delay-3"
                     style="margin-top: 20px;">
                    {% if form.facebook.url %}
                        <a id='link-facebook' href="#" class="social-icon-ar facebook"
                           onclick="editSocialURL('facebook', this.val())"><i
                                class="fa fa-facebook"></i></a>
                    {% else %}
                        <a id='link-facebook' href="#" class="social-icon-ar grey"
                           onclick="editSocialURL('facebook', 'http://www.facebook.com/')"><i
                                class="fa fa-facebook"></i></a>
                    {% endif %}

                    {% if form.google_plus.url %}
                        <a id='link-google-plus' href="#" class="social-icon-ar google-plus"
                           onclick="editSocialURL('google-plus', this.val())"><i
                                class="fa fa-google-plus"></i></a>
                    {% else %}
                        <a id='link-google-plus' href="#" class="social-icon-ar grey"
                           onclick="editSocialURL('google-plus', 'http://plus.google.com/')"><i
                                class="fa fa-google-plus"></i></a>
                    {% endif %}

                    {% if form.instagram.url %}
                        <a id='link-instagram' href="#" class="social-icon-ar instagram"
                           onclick="editSocialURL('instagram', this.val())"><i
                                class="fa fa-instagram"></i></a>
                    {% else %}
                        <a id='link-instagram' href="#" class="social-icon-ar grey"
                           onclick="editSocialURL('instagram', 'http://www.instagram.com/')"><i
                                class="fa fa-instagram"></i></a>
                    {% endif %}

                    {% if form.pinterest.url %}
                        <a id='link-pinterest' href="#" class="social-icon-ar pinterest"
                           onclick="editSocialURL('pinterest', this.val())"><i
                                class="fa fa-pinterest"></i></a>
                    {% else %}
                        <a id='link-pinterest' href="#" class="social-icon-ar grey"
                           onclick="editSocialURL('pinterest', 'http://www.pinterest.com/')"><i
                                class="fa fa-pinterest"></i></a>
                    {% endif %}

                    {% if form.twitter.url %}
                        <a id='link-twitter' href="#" class="social-icon-ar twitter"
                           onclick="editSocialURL('twitter', this.val())"><i
                                class="fa fa-twitter"></i></a>
                    {% else %}
                        <a id='link-twitter' href="#" class="social-icon-ar grey"
                           onclick="editSocialURL('twitter', 'http://www.twitter.com/')"><i
                                class="fa fa-twitter"></i></a>
                    {% endif %}
                </div>

                <div id='div-facebook' class="row hidden">
                    <div class="col-centered">
                        <div class="input-group" style="margin: 5px; text-align: center;">
                            {% render_field form.facebook class="form-control" name='facebook' style="width: 250px" %}
                            <button id="update-facebook" type="button" class="btn btn-ar btn-default"
                                    style="height: 35px; margin-left: 5px;" onclick="updateSocialURL('facebook')">
                                Update
                            </button>
                        </div>
                    </div>
                </div>
                <div id="div-instagram" class="row hidden">
                    <div class="col-centered">
                        <div class="input-group" style="margin: 5px; text-align: center;">
                            {% render_field form.instagram class="form-control" name='instagram' style="width: 250px" %}
                            <button id="update-instagram" type="button" class="btn btn-ar btn-default"
                                    style="height: 35px; margin-left: 5px;" onclick="updateSocialURL('instagram')">
                                Update
                            </button>
                        </div>
                    </div>
                </div>
                <div id="div-google-plus" class="row hidden">
                    <div class="col-centered">
                        <div class="input-group" style="margin: 5px; text-align: center;">
                            {% render_field form.google_plus class=" form-control" name='google-plus' id="id_google-plus" style="width: 250px" %}
                            <button id="update-google-plus" type="button" class="btn btn-ar btn-default"
                                    style="height: 35px; margin-left: 5px;" onclick="updateSocialURL('google-plus')">
                                Update
                            </button>
                        </div>
                    </div>
                </div>
                <div id="div-pinterest" class="row hidden">
                    <div class="col-centered">
                        <div class="input-group" style="margin: 5px; text-align: center;">
                            {% render_field form.pinterest class="form-control" name='pinterest' style="width: 250px" %}
                            <button id="update-pinterest" type="button" class="btn btn-ar btn-default"
                                    style="height: 35px; margin-left: 5px;" onclick="updateSocialURL('pinterest')">
                                Update
                            </button>
                        </div>
                    </div>
                </div>
                <div id="div-twitter" class="row hidden">
                    <div class="col-centered">
                        <div class="input-group" style="margin: 5px; text-align: center;">
                            {% render_field form.twitter class="form-control" name='twitter' style="width: 250px" %}
                            <button id="update-twitter" type="button" class="btn btn-ar btn-default"
                                    style="height: 35px; margin-left: 5px;" onclick="updateSocialURL('twitter')">
                                Update
                            </button>
                        </div>
                    </div>
                </div>
                <div id="social-link-error" class="hidden center">
                    <p class="hidden red" id="social-link-error-facebook">Please enter a valid Facebook link</p>
                    <p class="hidden red" id="social-link-error-google-plus">Please enter a valid Google Plus link</p>
                    <p class="hidden red" id="social-link-error-instagram">Please enter a valid Instagram link</p>
                    <p class="hidden red" id="social-link-error-pinterest">Please enter a valid Pinterest link</p>
                    <p class="hidden red" id="social-link-error-twitter">Please enter a valid Twitter link</p>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-md-9 ">
                <h2 class="section-title no-margin-top no-margin-bottom">
                    Project Pitch
                </h2>

                {{ form.pitch }}

                <h2 class="section-title">Time Line</h2>
                <ul class="timeline-2">

                    <li class="animated fadeInRight animation-delay-2">
                        <time class="timeline-time" datetime="">{{ form.date }} <span>{{ form.month }}</span></time>
                        <i class="timeline-2-point"></i>

                        <div class="panel panel-default">
                            <div class="panel-heading"
                                 style="color: white;">{% render_field form.new_timeline_post_title style='color: white' %}</div>
                            {{ form.new_timeline_post }}
                        </div>
                    </li>
                </ul>
            </div>
            <div class="col-md-3">
                <div class="content-box box-primary animated fadeInDown animation-delay-14">
                    <h4 class="content-box-title" style="margin-top: 0px; padding: 0px;"><strong>Creators</strong></h4>

                <div id="creators" class="media">
                    <div>
                        <a class="pull-left" href="#">
                            {% if user.userprofile.thumbnail %}
                                <img src="{{ user.userprofile.thumbnail.url }}"
                                     alt="{{ user.get_full_name }}" class="img-circle">
                            {% else %}
                                <img src="{% static "images/avatar.jpg" %}"
                                     alt="{{ user.get_full_name }}" class="img-circle" style="width: 50px">
                            {% endif %}
                        </a>

                        <div class="media-body" style="padding-left: 10px;">
                            <h4 class="media-heading"><a href="#" style="color: white">{{ user.get_full_name }}</a></h4>

                            <p>Technical Lead - piecing together the MVP</p>
                        </div>

                        <hr style="margin: 0px 0px 15px 0px; color: white;">
                    </div>
                </div>
                    <div class="ui-widget">
                        <input id="creatorInput" onkeyup="newCreator()" style="color: black; padding-left: 3px;" placeholder="Add a username">
                        <i id="addCreator" class="fa fa-plus-circle hidden" style="color: white;"
                           onclick="addCreator()"></i>
                    </div>

                    <div id="creator-error" class="hidden">
                        <p id="creator-error-message" style="margin: 10px 0px 0px 0px"></p>
                    </div>
                </div>
                <br>

                <div class="panel panel-default fadeInUp animation-delay-12">
                    <div class="panel-heading"><i class="fa fa-tags"></i>Tags</div>
                    <div class="panel-body">
                        <input type="text" value="New project" class="label-success" data-role="tagsinput"
                               style="display: none;">
                    </div>
                </div>


                <div class="panel panel-default animated fadeInUp animation-delay-12">
                    <div class="panel-heading"><i class="fa fa-database"></i> Technologies</div>
                    <div class="panel-body">

                        <div class="ui-widget">
                            <input id="technologyInput" onkeyup="newTechnology()">
                            <i id="addTechnology" class="fa fa-plus-circle hidden" style="color: #8ADE24;"
                               onclick="addTechnology()"></i>

                            <div id="technologies" style="margin-top: 10px"></div>
                        </div>
                    </div>
                </div>

                <div class="panel panel-default animated fadeInUp animation-delay-12">
                    <div class="panel-heading"><i class="fa fa-desktop"></i> Design and code</div>
                    <div class="panel-body center">
                        <p>Link to your project's Github account</p>

                        <a href="{% url 'social:begin' 'github' %}" class="animated fadeIn animation-delay-7 git"
                           style="color: transparent; padding-top: 20px">
                            <i class="fa fa-github fa-3x" style="color: #2a2a2a;"></i>
                        </a>
                    </div>
                </div>
                <br>
            </div>
        </div>
    </div>

{% endblock %}

{% block extra_scripts %}
    <script src="{% static "froala_editor/js/froala_editor.min.js" %}"></script>
    <script src="{% static "js/bootstrap-tagsinput.js" %}"></script>
    <script src="//code.jquery.com/ui/1.11.4/jquery-ui.js"></script>
    <script>
        $(function () {
            {% autoescape off %}
                var availableTags = {{ form.technologies }}
            {% endautoescape %}

            $("#technologyInput").autocomplete({
                source: availableTags
            });
        });

        var newCreator = function () {
            $('#addCreator').removeClass('hidden');

            if (event.keyCode == 13) {
                addCreator();
            }
        };

        var removeCreator = function (id) {
            $('#' + id).remove();
        };

        var addCreator = function (username) {
            var username = $('#creatorInput').val();

            if (username.length > 0) {
                $.ajax({
                    url: '{{ form.get_user_url }}',
                    type: 'GET',
                    dataType: 'json',
                    data: {'username': username},
                    success: function (data, textStatus, xhr) {
                        if (data.success === true) {
                            $('#creator-error').addClass('hidden');

                            var creators = $('#creators');

                            creators.append(
                                    '<div id="creator-' + data.username + '">' +
                                    '<a class="pull-left" href="#">' +
                                    '<img src="' + data.thumbnail + '"' +
                                    'alt="' + data.full_name + '" class="img-circle" style="width: 50px">' +
                                    '</a>' +

                                    '<div class="media-body" style="padding-left: 10px;">' +
                                    '<h4 class="media-heading"><a href="#" style="color: white">' + data.full_name + '</a></h4>' +

                                    {# '<p>Technical Lead - piecing together the MVP</p>' +#}

                                    '<p>' +
                                    '<strong>Awaiting Confirmation</strong>' +
                                    '<i class="fa fa-minus-circle" style="color: white; padding-left: 5px;" onclick="removeCreator(&quot;creator-' + data.username + '&quot;)"></i>' +
                                    '</p>' +
                                    '</div>' +
                                    '<hr style="margin: 0px 0px 15px 0px; color: white;">' +
                                    '</div> ')
                        }
                        else {
                            $('#creator-error').removeClass('hidden');
                            $('#creator-error-message').text(data.message);
                        }
                    },
                    error: function (xhr, textStatus, errorThrown) {
                        $('#creator-error').removeClass('hidden');
                        $('#creator-error-message').html('<i class="fa fa-exclamation-circle" style="color: white; margin-right: 3px;"></i> ' + xhr.responseJSON.message);
                    }
                });
            }
            else {
                $('#creator-error').removeClass('hidden');
                $('#creator-error-message').html('<i class="fa fa-exclamation-circle" style="color: white; margin-right: 3px;"></i> Please provide a username');
            }

            $('#creatorInput').val('');
            $('#addCreator').addClass('hidden');
        };

        var newTechnology = function () {
            $('#addTechnology').removeClass('hidden');

            if (event.keyCode == 13) {
                addTechnology();
            }
        };

        var addTechnology = function () {
            var value = $('#technologyInput').val();

            $('#technologies').append('<p class="addedTechnology" id="technology-' + value + '">' + value + '<i id="technology-' + value + '" class="fa fa-minus-circle" style="color: red; padding-left: 5px;" onclick="removeTechnology(this.id)"></i><p>');

            $('#technologyInput').val('');
            $('#addTechnology').addClass('hidden');
        };

        var removeTechnology = function (id) {
            $('#' + id).remove();
        };

        var editSocialURL = function (name, link) {
            var input = $('#id_' + name);
            if (input.val() == '') {
                input.val(link);
            }

            $('#div-' + name).removeClass('hidden');
        };

        var updateSocialKeyUp = function (name) {
            if (event.keyCode == 13) {
                updateSocialURL(name);
            }
        };

        var updateSocialURL = function (name) {
            var input = $('#id_' + name),
                    link = input.val(),
                    icon = $('#link-' + name),
                    inputDiv = $('#div-' + name),
                    errorMessageDiv = $('#social-link-error'),
                    errorMesage = $('#social-link-error-' + name),
                    valid = false;

            if (name === 'google-plus'
                    && (link.startsWith('http://plus.google.com/')
                        || link.startsWith('https://plus.google.com/')
                        || link.startsWith('www.plus.google.com/'))
                    && (!link.endsWith('.com/') && !link.endsWith('.com'))){
                valid = true;
            }
            else if ((link.startsWith('http://www.' + name + '.com/')
                        || link.startsWith('https://www.' + name + '.com/')
                        || link.startsWith('www.' + name + '.com/'))
                      && (!link.endsWith('.com/') && !link.endsWith('.com'))){
                valid = true;
            }

            if (valid) {
                $('#div-' + name).addClass('hidden');

                icon.removeClass('grey');
                icon.addClass(name);

                inputDiv.removeClass('has-error');
                errorMesage.addClass('hidden');
            }
            else {
                inputDiv.addClass('has-error');

                errorMessageDiv.removeClass('hidden');
                errorMesage.removeClass('hidden');
            }
        };

        $("#id_facebook").keyup(function () {
            updateSocialKeyUp('facebook');
        });
        $("#id_google-plus").keyup(function () {
            updateSocialKeyUp('google-plus');
        });
        $("#id_instagram").keyup(function () {
            updateSocialKeyUp('instagram');
        });
        $("#id_pinterest").keyup(function () {
            updateSocialKeyUp('pinterest');
        });
        $("#id_twitter").keyup(function () {
            updateSocialKeyUp('twitter');
        });

        $(function(){
          $('.logo').editable({})
        });
    </script>


{% endblock %}


